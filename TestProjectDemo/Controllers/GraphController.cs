using System;
using System.Collections.Generic;
using System.Drawing;
using System.Drawing.Imaging;
using System.IO;
using System.Linq;
using System.Web;
using System.Web.Mvc;

namespace TestProjectDemo.Controllers
{
    public class GraphController : Controller
    {
        //
        // GET: /Graph/

        public ActionResult Index()
        {
            ViewBag.str = ConvertHtmlToImage();
            string value = "10,20,20,30";

            // Use ToCharArray to convert string to array.

            var fooArray = value.Split(',');  // now you have an array of 3 strings
            value = String.Join(",", fooArray); // now you have the same as in the first line
            string[] stringArray = new string[] { value };
            // Loop through array.
            for (int i = 0; i < fooArray.Length; i++)
            {
                // Get character from array.
                string letter = fooArray[i];
                 
             
            }

            return View();
        }
        public IHtmlString ConvertHtmlToImage()
        {
            Bitmap m_Bitmap = new Bitmap(400, 600);
            PointF point = new PointF(0, 0);
            SizeF maxSize = new System.Drawing.SizeF(500, 500);
         
            IHtmlString str = new HtmlString("<a href='/Home/Profile/seeker'>seeker</a> has applied to <a href='/Jobs/Details/9'>Job</a> floated by you.</br>");
            //m_Bitmap.Save(@"C:\Test.png", ImageFormat.Png);
            return str;
        }
        public ActionResult UploadFile()
        {
            return View();
        }
        [HttpPost]
        [ValidateInput(false)]
        public ActionResult UploadFile(HttpPostedFileBase httpPostedFile)
        {
           // var httpPostedFile = Request.Files[0];
            if (httpPostedFile != null)
            {

                // Validate the uploaded file if you want like content length(optional)

                // Get the complete file path
                var uploadFilesDir = System.Web.HttpContext.Current.Server.MapPath("~/Content/Videos");
                if (!Directory.Exists(uploadFilesDir))
                {
                    Directory.CreateDirectory(uploadFilesDir);
                }
                var fileSavePath = Path.Combine(uploadFilesDir, httpPostedFile.FileName);

                // Save the uploaded file to "UploadedFiles" folder
                httpPostedFile.SaveAs(fileSavePath);

            }

            return Content("Uploaded Successfully");
        }
        //public FileResult Download()
        //{
        //    string stringFromSQL = "0x530079007300740065006D002E0042007900740065005B005D00";
        //    List<byte> byteList = new List<byte>();

        //    string hexPart = stringFromSQL.Substring(2);
        //    for (int i = 0; i < hexPart.Length / 2; i++)
        //    {
        //        string hexNumber = hexPart.Substring(i * 2, 2);
        //        byteList.Add((byte)Convert.ToInt32(hexNumber, 16));
        //    }

        //    byte[] original = byteList.ToArray();
        //    //byte[] fileBytes = System.IO.File.ReadAllBytes(@"c:\folder\myfile.ext");
        //    string fileName = "Prerelase apps.docx";
        //    return File(original, "application/vnd.openxmlformats-officedocument.wordprocessingml.document", fileName);
        //}

        public FileContentResult Download()
        {
            try
            {

                string stringFromSQL = "0x255044462D312E330A332030206F626A0A3C3C2F54797065202F506167650A2F506172656E742031203020520A2F5265736F75726365732032203020520A2F436F6E74656E74732034203020523E3E0A656E646F626A0A342030206F626A0A3C3C2F4C656E677468203136323E3E0A73747265616D0A302E353720770A3020470A710A712042542034322E3532203739392E33372054640A30202D31342E30342054640A2F4631302031342E3034205466202848656C6C6F2C20746869732069732061204833207461672920546A0A455420510A712042542034322E3532203737312E32392054640A30202D31322E30302054640A2F46392031322E30302054662028612070617261726170682920546A0A455420510A510A656E6473747265616D0A656E646F626A0A312030206F626A0A3C3C2F54797065202F50616765730A2F4B696473205B3320302052205D0A2F436F756E7420310A2F4D65646961426F78205B302030203539352E3238203834312E38395D0A3E3E0A656E646F626A0A352030206F626A0A3C3C2F42617365466F6E742F48656C7665746963612F547970652F466F6E740A2F456E636F64696E672F57696E416E7369456E636F64696E670A2F537562747970652F54797065313E3E0A656E646F626A0A362030206F626A0A3C3C2F42617365466F6E742F48656C7665746963612D426F6C642F547970652F466F6E740A2F456E636F64696E672F57696E416E7369456E636F64696E670A2F537562747970652F54797065313E3E0A656E646F626A0A372030206F626A0A3C3C2F42617365466F6E742F48656C7665746963612D4F626C697175652F547970652F466F6E740A2F456E636F64696E672F57696E416E7369456E636F64696E670A2F537562747970652F54797065313E3E0A656E646F626A0A382030206F626A0A3C3C2F42617365466F6E742F48656C7665746963612D426F6C644F626C697175652F547970652F466F6E740A2F456E636F64696E672F57696E416E7369456E636F64696E670A2F537562747970652F54797065313E3E0A656E646F626A0A392030206F626A0A3C3C2F42617365466F6E742F436F75726965722F547970652F466F6E740A2F456E636F64696E672F57696E416E7369456E636F64696E670A2F537562747970652F54797065313E3E0A656E646F626A0A31302030206F626A0A3C3C2F42617365466F6E742F436F75726965722D426F6C642F547970652F466F6E740A2F456E636F64696E672F57696E416E7369456E636F64696E670A2F537562747970652F54797065313E3E0A656E646F626A0A31312030206F626A0A3C3C2F42617365466F6E742F436F75726965722D4F626C697175652F547970652F466F6E740A2F456E636F64696E672F57696E416E7369456E636F64696E670A2F537562747970652F54797065313E3E0A656E646F626A0A31322030206F626A0A3C3C2F42617365466F6E742F436F75726965722D426F6C644F626C697175652F547970652F466F6E740A2F456E636F64696E672F57696E416E7369456E636F64696E670A2F537562747970652F54797065313E3E0A656E646F626A0A31332030206F626A0A3C3C2F42617365466F6E742F54696D65732D526F6D616E2F547970652F466F6E740A2F456E636F64696E672F57696E416E7369456E636F64696E670A2F537562747970652F54797065313E3E0A656E646F626A0A31342030206F626A0A3C3C2F42617365466F6E742F54696D65732D426F6C642F547970652F466F6E740A2F456E636F64696E672F57696E416E7369456E636F64696E670A2F537562747970652F54797065313E3E0A656E646F626A0A31352030206F626A0A3C3C2F42617365466F6E742F54696D65732D4974616C69632F547970652F466F6E740A2F456E636F64696E672F57696E416E7369456E636F64696E670A2F537562747970652F54797065313E3E0A656E646F626A0A31362030206F626A0A3C3C2F42617365466F6E742F54696D65732D426F6C644974616C69632F547970652F466F6E740A2F456E636F64696E672F57696E416E7369456E636F64696E670A2F537562747970652F54797065313E3E0A656E646F626A0A322030206F626A0A3C3C0A2F50726F63536574205B2F504446202F54657874202F496D61676542202F496D61676543202F496D616765495D0A2F466F6E74203C3C0A2F46312035203020520A2F46322036203020520A2F46332037203020520A2F46342038203020520A2F46352039203020520A2F4636203130203020520A2F4637203131203020520A2F4638203132203020520A2F4639203133203020520A2F463130203134203020520A2F463131203135203020520A2F463132203136203020520A3E3E0A2F584F626A656374203C3C0A3E3E0A3E3E0A656E646F626A0A31372030206F626A0A3C3C0A2F50726F647563657220286A73504446203230313230363139290A2F4372656174696F6E446174652028443A3230313630393239303434363231290A3E3E0A656E646F626A0A31382030206F626A0A3C3C0A2F54797065202F436174616C6F670A2F50616765732031203020520A2F4F70656E416374696F6E205B3320302052202F46697448206E756C6C5D0A2F506167654C61796F7574202F4F6E65436F6C756D6E0A3E3E0A656E646F626A0A787265660A302031390A303030303030303030302036353533352066200A30303030303030323938203030303030206E200A30303030303031353237203030303030206E200A30303030303030303039203030303030206E200A30303030303030303837203030303030206E200A30303030303030333835203030303030206E200A30303030303030343735203030303030206E200A30303030303030353730203030303030206E200A30303030303030363638203030303030206E200A30303030303030373730203030303030206E200A30303030303030383538203030303030206E200A30303030303030393532203030303030206E200A30303030303031303439203030303030206E200A30303030303031313530203030303030206E200A30303030303031323433203030303030206E200A30303030303031333335203030303030206E200A30303030303031343239203030303030206E200A30303030303031373531203030303030206E200A30303030303031383333203030303030206E200A747261696C65720A3C3C0A2F53697A652031390A2F526F6F74203138203020520A2F496E666F203137203020520A3E3E0A7374617274787265660A313933370A2525454F46";
                    List<byte> byteList = new List<byte>();

                    string hexPart = stringFromSQL.Substring(2);
                    for (int i = 0; i < hexPart.Length / 2; i++)
                    {
                        string hexNumber = hexPart.Substring(i * 2, 2);
                        byteList.Add((byte)Convert.ToInt32(hexNumber, 16));
                    }

                    byte[] original = byteList.ToArray();
                    //byte[] fileData;
                    string fileName;
                  
                    //fileData = (byte[])record.UploadFiles.ToArray();
                    fileName = "sample-file.pdf";

                    return File(original, "text", fileName);
                

            }
            catch (Exception ex)
            {
                throw ex;
            }
        }
    }
}
